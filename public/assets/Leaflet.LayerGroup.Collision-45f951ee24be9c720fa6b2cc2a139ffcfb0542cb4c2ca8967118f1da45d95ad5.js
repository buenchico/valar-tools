function extensions(e){return{initialize:function(i){e.prototype.initialize.call(this,i),this._originalLayers=[],this._visibleLayers=[],this._staticLayers=[],this._rbush=[],this._cachedRelativeBoxes=[],this._margin=i.margin||0,this._rbush=null},addLayer:function(i){if(!("options"in i&&"icon"in i.options))return this._staticLayers.push(i),void e.prototype.addLayer.call(this,i);this._originalLayers.push(i),this._map&&this._maybeAddLayerToRBush(i)},removeLayer:function(i){var t;this._rbush.remove(this._cachedRelativeBoxes[i._leaflet_id]),delete this._cachedRelativeBoxes[i._leaflet_id],e.prototype.removeLayer.call(this,i),-1!==(t=this._originalLayers.indexOf(i))&&this._originalLayers.splice(t,1),-1!==(t=this._visibleLayers.indexOf(i))&&this._visibleLayers.splice(t,1),-1!==(t=this._staticLayers.indexOf(i))&&this._staticLayers.splice(t,1)},clearLayers:function(){this._rbush=rbush(),this._originalLayers=[],this._visibleLayers=[],this._staticLayers=[],this._cachedRelativeBoxes=[],e.prototype.clearLayers.call(this)},onAdd:function(e){for(var i in this._map=e,this._staticLayers)e.addLayer(this._staticLayers[i]);this._onZoomEnd(),e.on("zoomend",this._onZoomEnd,this)},onRemove:function(i){for(var t in this._staticLayers)i.removeLayer(this._staticLayers[t]);i.off("zoomend",this._onZoomEnd,this),e.prototype.onRemove.call(this,i)},_maybeAddLayerToRBush:function(i){this._map.getZoom();var t=this._rbush,o=this._cachedRelativeBoxes[i._leaflet_id],s=!1;if(!o){e.prototype.addLayer.call(this,i);s=!0;var r=this._getIconBox(i._icon);(o=this._getRelativeBoxes(i._icon.children,r)).push(r),this._cachedRelativeBoxes[i._leaflet_id]=o}o=this._positionBoxes(this._map.latLngToLayerPoint(i.getLatLng()),o);for(var n=!1,a=0;a<o.length&&!n;a++)n=t.search(o[a]).length>0;n?e.prototype.removeLayer.call(this,i):(s||e.prototype.addLayer.call(this,i),this._visibleLayers.push(i),t.load(o))},_getIconBox:function(e){if(isMSIE8)return[0,0,e.offsetWidth,e.offsetHeight];var i=window.getComputedStyle(e);return[parseInt(i.marginLeft),parseInt(i.marginTop),parseInt(i.marginLeft)+parseInt(i.width),parseInt(i.marginTop)+parseInt(i.height)]},_getRelativeBoxes:function(e,i){for(var t=[],o=0;o<e.length;o++){var s=e[o],r=[s.offsetLeft,s.offsetTop,s.offsetLeft+s.offsetWidth,s.offsetTop+s.offsetHeight];if(r=this._offsetBoxes(r,i),t.push(r),s.children.length){var n=i;if(!isMSIE8){var a=window.getComputedStyle(s).position;"absolute"!==a&&"relative"!==a||(n=r)}t=t.concat(this._getRelativeBoxes(s.children,n))}}return t},_offsetBoxes:function(e,i){return[e[0]+i[0],e[1]+i[1],e[2]+i[0],e[3]+i[1]]},_positionBoxes:function(e,i){for(var t=[],o=0;o<i.length;o++)t.push(this._positionBox(e,i[o]));return t},_positionBox:function(e,i){return[i[0]+e.x-this._margin,i[1]+e.y-this._margin,i[2]+e.x+this._margin,i[3]+e.y+this._margin]},_onZoomEnd:function(){for(var i=0;i<this._visibleLayers.length;i++)e.prototype.removeLayer.call(this,this._visibleLayers[i]);this._rbush=rbush();for(i=0;i<this._originalLayers.length;i++)this._maybeAddLayerToRBush(this._originalLayers[i])}}}var isMSIE8=!("getComputedStyle"in window&&"function"==typeof window.getComputedStyle);L.LayerGroup.Collision=L.LayerGroup.extend(extensions(L.LayerGroup)),L.FeatureGroup.Collision=L.FeatureGroup.extend(extensions(L.FeatureGroup)),L.GeoJSON.Collision=L.GeoJSON.extend(extensions(L.GeoJSON)),L.LayerGroup.collision=function(e){return new L.LayerGroup.Collision(e||{})},L.FeatureGroup.collision=function(e){return new L.FeatureGroup.Collision(e||{})},L.GeoJSON.collision=function(e){return new L.GeoJSON.Collision(e||{})},L.layerGroup.collision=function(e){return new L.LayerGroup.Collision(e||{})},L.featureGroup.collision=function(e){return new L.FeatureGroup.Collision(e||{})},L.geoJson.collision=function(e){return new L.GeoJSON.Collision(e||{})};