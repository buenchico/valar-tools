<script>
$(document).ready(function(){
    var step_id = 0;
    $("#add_step").click(function(){
        step_id++;
        $('<div/>', {
            'id' : 'step' + step_id, 'class' : 'form-group form-inline', html: `<div class="input-group mb-2">
                                                                                <div class="input-group-prepend">
                                                                                     <div class="input-group-text">Distancia</div>
                                                                                </div>
                                                                                <%=j number_field_tag("X", nil, {class: "custom-control", placeholder: "en hexágonos", id: nil}) %>
                                                                            </div>
                                                                            <div class="input-group mb-2">
                                                                                <div class="input-group-prepend">
                                                                                     <div class="input-group-text">Tipo de terreno</div>
                                                                                </div>
                                                                                <%=j select_tag("X", options_for_select(@terrain_type), {id: nil, class: "custom-select"}) %>
                                                                            </div>
                                                                            <div class="input-group mb-2">
                                                                                <div class="input-group-prepend">
                                                                                     <div class="input-group-text">Tipo de marcha</div>
                                                                                </div>
                                                                                <%=j select_tag("X", options_for_select(@walking_type), {id: nil, class: "custom-select"}) %>
                                                                            </div>
                                                                            <div class="input-group mb-2">
                                                                                <div class="input-group-prepend">
                                                                                     <div class="input-group-text">Obstáculo</div>
                                                                                </div>
                                                                                <%=j select_tag("X", options_for_select(@obstacle_type), {id: nil, class: "custom-select"}) %>
                                                                            </div>`
                        }).insertAfter('#step' + parseInt(step_id - 1));
        $('form [name="X"]').attr("name","step["+step_id+"][]")
        if (step_id == 10) $("#add_step").prop( "disabled", true );
    });
    $("#rem_step").click(function(){
        $("#step" + step_id).hide();
        step_id--;
        if (step_id != 10) $("#add_step").prop( "disabled", false );
    });    
});
</script>

<% provide(:title, "Calculadora de rutas") %>
<% provide(:description, "Con esta herramienta pueden calcularse los tiempos de viaje de acuerdo a las reglas de la partida") %>


<p class="tool-title">
    <i class="fas fa-map-signs white"></i>
    <%= yield(:title) %>
</p>

<div>
  <%= form_with url: travel_calculator_calculate_path, local: true do |form| %>
    <div class="form-group form-inline">
        <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text">Origen</div>
            </div>
          <%= form.text_field :from, class: "form-control", placeholder: "origen" %>
        </div>
        <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text">Destino</div>
            </div>
          <%= form.text_field :to, class: "custom-control", placeholder: "destino" %>
        </div>
    </div>
    <div class="form-group form-inline">
        <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text">Nº Ejércitos</div>
            </div>
          <%= form.number_field :size, class: "custom-control", placeholder: "0 para personajes" %>
        </div>          
        <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text">¿Carretas?</div>
            </div>
            <div class="form-check checkbox-slider--a-rounded checkbox-slider-lg">
	            <label>
		            <%= form.check_box :carts, {class: "custom-checkbox"} %><span>&nbsp;</span>
	            </label>
            </div>
        </div>
    </div>
    
    <div id="step0" class="form-group form-inline">
        <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text">Distancia</div>
            </div>
          <%= form.number_field "step[0][]", class: "custom-control", placeholder: "en hexágonos" %>
        </div>
        <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text">Tipo de terreno</div>
            </div>
          <%= form.select("step[0][]", options_for_select(@terrain_type), {}, {class: "custom-select"}) %>
        </div>
        <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text">Tipo de marcha</div>
            </div>
            <%= form.select("step[0][]", options_for_select(@walking_type), {}, {class: "custom-select"}) %>
        </div>
        <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text">Obstáculo</div>
            </div>
          <%= form.select("step[0][]", options_for_select(@obstacle_type), {}, {class: "custom-select"}) %>
        </div>
    </div>
        <div class="form-group form-inline">
            <button type="button" id="add_step" class="btn btn-success"><i class="fas fa-plus-circle"></i> Añadir etapa</button>
            <button type="button" id="rem_step" class="btn btn-danger"><i class="fas fa-times-circle"></i> Eliminar etapa</button> 
        </div>
        <div class="form-group form-inline">
          <%= form.submit "Calcular", class: "btn btn-primary", id: "calculate" %>
        </div>
    <% end %>
</div>